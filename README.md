# Клиентская часть мессенджера

## Репозиторий серверной части
Быстрый переход к [серверной части](https://github.com/Firegreat78/msg_server).

## Описание клиента

### Окно авторизации

Окно авторизации может работать в двух режимах:
- Режим логина;
- Режим регистрации.


После запуска приложения нас встречает окно авторизации, установленное в режим логина:

![image](https://github.com/user-attachments/assets/bccbde89-79bc-4ddb-851e-57b5fb776d98)

При нажатии на кнопку "Изменить режим..." режим меняется на режим регистрации:

![image](https://github.com/user-attachments/assets/657b783e-dd7c-4a5b-9e0c-0aaadda037de)

В поля "имя пользователя" и "логин" можно ввести только следующие символы: 0-9, _, A-Z, a-z. Имена пользователей и логины уникальны в пределах базы данных.

### Режим логина

Если ввести некорректный логин и/или пароль, то авторизация не пройдёт. В успешном случае появится главное окно программы.

### Режим регистрации

Если ввести имя пользователя/логин, который приведёт к нарушению уникальности, то регистрация нового пользователя не пройдёт. В успешном случае в базу данных добавится информация о новом пользователе.

### Аварийное отключение сервера

Если соединение с сервером пропадёт, то состояние клиента будет следующим (кнопки "войти" и "зарегистрироваться" теперь недоступны):

![image](https://github.com/user-attachments/assets/57dd047f-0c3f-4bdf-b3bd-56ad7efc2153)

Будет запущен таймер с интервалом в 60 секунд, по истечении которого будет осуществлена попытка подключения к серверу. 
В случае неудачи таймер снова будет запущен с интервалом в 60 секунд. 
В случае успешного подключения - окно вернётся к своему нормальному состоянию (кнопки "войти" и "зарегистрироваться" станут снова доступны).

### Главное окно программы

Главное окно программы непосредственно после авторизации выглядит так:

![image](https://github.com/user-attachments/assets/78f7099b-a934-4177-b1f8-52c54dea9b69)

Слева - список личных чатов. Там расположены все пользователи, кроме текущего авторизованного, с указанием дополнительной информации.

Дополнительная информация содержит в себе:
- Отображаемое имя;
- Статус "в сети". Если пользователь в сети, написано "В сети". Если пользователь не в сети, отображено, когда последний раз пользователь был в сети.

В случае, если в чате присутствует хотя бы одно сообщение, отображается информация о последнем сообщении:
- Имя пользователя, отправившего последнее сообщение;
- Дата и время отправки сообщения;
- Содержимое сообщения.

В случае, если присутствуют непрочитанные сообщения от другого пользователя, указывается их количество.

#### Подгрузка сообщений

При подгрузке сообщений после выбора чата учитываается:
- Количество сообщений в чате;
- Наличие хотя бы одного непрочитанного сообщения.

Если в чате более N сообщений, то будут подгружены не все сообщения ради экономии места. 
Сообщения подгружаются по мере того как пользователь scroll'ит вверх или вниз. 
При подгрузке сообщений сверху (более старых) удаляются блоее новые, и наоборот.

Если есть хотя бы одно непрочитанное сообщение, клиент запрашивает у сервера равное количество сообщений так, чтобы самое старое непрочитанное было в середине (N/2 сообщений до и после самого старого непрочитанного).
Иначе, загружаются N последних сообщений.

При выборе чата автоматически сбрасываются все фильтры.

#### Чат и сообщения

Чат выглядит следующим образом:

![image](https://github.com/user-attachments/assets/56ad1e69-b996-4da6-b219-aecf1b3f615b)

![image](https://github.com/user-attachments/assets/66818c94-d6de-4de1-93ba-e0302ea1c0bf)


Сообщения содержат следующую информацию:
- В случае, если сообщение является ответом на другое сообщение: указывается имя пользователя и содержимое сообщения, но которое был дан ответ.
  Если это сообщение впоследствии будет удалено, вместо этого будет написано "Оригинальное сообщение удалено...";
- Имя пользователя, отправившего сообщение;
- Дата и время отправки сообщения;
- Если сообение отредактировано: указывается дата и время последнего редактирования;
- Текст сообщения;
- Статус "прочитано/не прочитано".

К сообщениям, на которые был дан ответ, можно переходить:

![image](https://github.com/user-attachments/assets/f6c8a20b-2e70-4391-b7f6-cb1dba6426a8)

Если сообщение находится в области видимости чата (было подгружено), то происходит перемещение scrollbar'а к сообщению так, чтобы оно было как можно ближе к центру чата.
В противном случае чат затирается и происходит переподгрузка сообщений с чата так, чтобы оно было в середине (N/2 сообщений до и после). 
При переходе сообщение подсвечивается на короткое время, а также автоматически сбрасываются все фильтры.

Переход выглядит так:

![image](https://github.com/user-attachments/assets/86407ca3-a6d1-47bf-9a6e-38161f6e3b57)

Присутствует возможность фильтрации:
- По содержимому;
- По дате и времени отправки;
- По непрочитанным (будут показываться только сообщения от собеседника, которые ещё не были прочитаны, при этом собственные сообщения не будут показаны).

Вся видимая информация о сообщениях на экране регулярно запрашивается с базы данных, это позволяет в реальном времени отслеживать изменение/удаление сообщений.
Сообщения, которые не в области видимости экрана из-за позиции scrollbar'а, не обновляются.

#### Обновление чатов

В случае, если новый пользователь авторизует новый аккаунт, он не появится в списле слева. Чтобы он появился, нужно нажать кнопку "Обновить чаты". 
Однако, информация об уже загруженных пользователях (последнее сообщение, количество непрочитанных...) будет обновляться автоматически.

#### Информация об авторизованном пользователе

![image](https://github.com/user-attachments/assets/92e2d66a-09d6-4425-b2e5-7fc4a44bdf85)

Имеется возможность сменить имя пользователя или пароль, а также удалить учётную запись.
При удалении учётной записи удаляются все сообщения в личных чатах с этим пользователем. 

#### Дополнительная информация о непрочитанных сообщениях

Указывается количество неподгруженных непрочитанных сообщений выше/ниже текущей области, а также подгруженных непрочитанных сообщений внутри текущей области чата: 

![image](https://github.com/user-attachments/assets/5f66d23e-72a2-40ba-8af2-f3c215208cb1)

#### Статус соединения с сервером

Здесь можно увидеть текущий статус соединения с сервером и возможность переподключиться. В случае отсутствия соединения:
- Невозможен переход в другой чат;
- Солобщения сверху/снизу не будут автоподгружаться по мере того, как пользователь scroll'ит чат;
- Невозможна отправка/редактирование/удаление сообщений;
- Невозможен переход к неподгруженному сообщению через сообщение-ответ (переход к уже подгруженному сообщению будет работать).

![image](https://github.com/user-attachments/assets/d3fb5188-3b26-416d-b587-dea4bec518d1)

#### Выход из аккаунта

При выходе/удалении из аккаунта происходит переход к окну авторизации.

Выйти из аккаунта (но не удалить его) можно в случае отсутствия соединения с socket'ом сервера 
(произойдёт переход к окну авторизации, но без отправки json'а на сервер, 
на сервере уже предусмотрен механизм подсчёта количества login'ов с поддержкой внезапного отсоединения socket'ов).

![image](https://github.com/user-attachments/assets/9a2fb8fa-7d1a-4a23-99af-71af7cec2647)

